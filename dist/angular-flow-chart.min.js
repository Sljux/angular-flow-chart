"use strict";angular.module("ngFlow.chart",["ngFlow.websocket","chart.js"]).directive("flowChart",["$timeout",function(a){function b(a,b){function c(){d.flow.subscribe(a.flowId,function(b){g.push(b),a.$broadcast("flowChart:newDrop",b)})}var d=a.flowSocket,e=a.flowId,f=a.limit,g=[];d.flow.search(e,"",f).then(function(b){g=b.reverse(),c(),a.$broadcast("flowChart:init",g)}),b.on("$destroy",function(){d.flow.unsubscribe(e),a.$broadcast("flowChart:destroy")})}function c(a){this.limit=a.limit}return c.$inject=["$scope"],{restrict:"E",transclude:!0,scope:{limit:"=",flowId:"=",flowSocket:"="},template:"<div ng-transclude></div>",link:b,controller:c}}]).directive("flowChartJs",function(){function a(a,b){var c=b.chartType;if(!angular.isUndefined(c))return'<canvas class="chart chart-'+c+'" data="[graphData]" options="chartOptions" labels="labels" legend="legend" click="click" hover="hover" series="series" colours="colours"></canvas>'}function b(a,b,c,d){function e(a,b,c){return a.slice(-n).map(function(a){return f(b,a,c)})}function f(a,b,c){for(var d=b,e=0;e<a.length;e++){var f=a[e];if(!i(d[f])){d=c;break}d=d[f]}return d}function g(a){return a?a.split("."):[]}function h(a){for(var b=Array(a),c=0;a>c;c++)b[c]=c;return b}var i=angular.isDefined,j=g(a.valueProperty),k=g(a.labelProperty),l=a.valueDefault||null,m=a.labelDefault||null,n=d.limit;a.graphData=[],a.labels=[],a.$on("flowChart:init",function(b,c){a.graphData=e(c,j,l),a.labels=k.length>0?e(c,k,m):h(a.graphData.length)}),a.$on("flowChart:newDrop",function(b,c){a.graphData.push(f(j,c,l));var d=k.length>0?f(k,c):a.labels[a.labels.length-1]+1;a.labels.push(d),a.graphData.length>n&&(a.graphData.shift(),a.labels.shift())})}return{restrict:"E",require:"^flowChart",template:a,scope:{chartType:"@",chartOptions:"=",valueProperty:"@",valueDefault:"@",labelProperty:"@",labelDefault:"@",series:"=",click:"=?",hover:"=?",legend:"=",colours:"=?"},link:b}});